{% extends "layout.html" %}

{% block content %}

<script type="text/javascript">
    $(document).ready(function () {
        display_error = (message) => { $("#error").html('<div class="alert alert-danger" role="alert">' + message + '</div>'); };
        display_scan_results = (results) => { $("#scan_results").html(results); };
        display_file_info = (results) => { $("#file_info").html(results); };
        let url = $(location).attr('href').split("/");

        function getDetection() {
            $.ajax({
                type: "POST",
                url: url[url.length-1] + "/detection",
                success: callbackDetection
            });
        }

        function callbackDetection(response) {
            reponse_json = jQuery.parseJSON(response)
            if (reponse_json.status === 'error'){
                display_error(reponse_json.error_message);
                display_scan_results('');
            } else if (reponse_json.status === 'success'){
                display_scan_results(reponse_json.table_html_scan_results);
            }
        }
        
        function getFileInfo() {
            $.ajax({
                type: "POST",
                url: url[url.length-1] + "/info",
                success: callbackFileInfo
            });
        }

        function callbackFileInfo(response) {
            reponse_json = jQuery.parseJSON(response)
            if (reponse_json.status === 'error'){
                display_error(reponse_json.error_message);
                display_file_info('');
            } else if (reponse_json.status === 'success'){
                display_file_info(reponse_json.html_file_info);
            }
        }

        getDetection();
        getFileInfo();
    })
</script>

<div class="row d-flex justify-content-center mt-100">
    <div class="col-md-8">
        <div id="error"></div>
        <div class="card">
            <div class="card-header">
                <h5>File info</h5>
            </div>
            <div class="card-block">
                <div id="file_info">
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="sr-only">Scanning...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <h5>Scan result</h5>
            </div>
            <div class="card-block">
                <div id="scan_results">
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="sr-only">Scanning...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock%}