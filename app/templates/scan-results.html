{% extends "layout.html" %}

{% block content %}

<script type="text/javascript">
    $(document).ready(function () {
        execAjax = (uri, callback) => {
            let url = $(location).attr('href').split("/");
            $.ajax({
                type: "POST",
                url: url[url.length-1] + "/" + uri,
                success: callback
            });
        };
        displayResults = (selector, results) => { $(selector).html(results); };
        displayError = (message) => { displayResults('#error', '<div class="alert alert-danger" role="alert">' + message + '</div>') };
        displayScanResults = (results) => { displayResults('#scan_results', results) };
        displayFileInfo = (results) => { displayResults('#file_info', results) };
        displayStrings = (results) => { displayResults('#strings', results) };

        getDetection = () => execAjax("detection", (response) => {
            response_json = jQuery.parseJSON(response)
            if (response_json.status === 'error'){
                displayError(response_json.error_message);
                displayScanResults('');
            } else if (response_json.status === 'success'){
                displayScanResults(response_json.result.table_html_scan_results);
            }
        });

        getFileInfo = () => execAjax("info", (response) =>  {
            response_json = jQuery.parseJSON(response)
            if (response_json.status === 'error'){
                displayError(response_json.error_message);
                displayFileInfo('');
            } else if (response_json.status === 'success'){
                displayFileInfo(JSON.stringify(response_json.result));
            }
        });

        getStrings = () => execAjax("strings", (response) =>  {
            response_json = jQuery.parseJSON(response)
            if (response_json.status === 'error'){
                displayError(response_json.error_message);
                displayStrings('');
            } else if (response_json.status === 'success'){
                displayStrings(response_json.result.table_html_strings);
            }
        });

        getDetection();
        getFileInfo();
        getStrings();
    })
</script>

<div class="row d-flex justify-content-center mt-100">
    <div class="col-md-8">
        <div id="error"></div>
        <div class="card">
            <div class="card-header">
                <h5>File info</h5>
            </div>
            <div class="card-block">
                <div id="file_info">
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="sr-only">Scanning...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <h5>Scan result</h5>
            </div>
            <div class="card-block">
                <div id="scan_results">
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="sr-only">Scanning...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <h5>Strings</h5>
            </div>
            <div class="card-block">
                <div id="strings">
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="sr-only">Scanning...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock%}